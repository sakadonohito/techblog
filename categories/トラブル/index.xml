<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>トラブル on 開発メモてきな</title>
    <link>http://tech.k-zak.com/categories/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB/index.xml</link>
    <description>Recent content in トラブル on 開発メモてきな</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <atom:link href="http://tech.k-zak.com/categories/%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Vagrant、最終的にはEC2にAnsibleでWordPressを構築を試みる2</title>
      <link>http://tech.k-zak.com/2014/09/07/challenge-ansible</link>
      <pubDate>Sun, 07 Sep 2014 17:28:17 +0000</pubDate>
      
      <guid>http://tech.k-zak.com/2014/09/07/challenge-ansible</guid>
      <description>&lt;p&gt;・botoが使えないってエラーになる。&lt;/p&gt;

&lt;p&gt;　→次のURLで解決 &lt;a href=&#34;https://groups.google.com/forum/#!topic/ansible-project/ftlmfIC1DHk&#34;&gt;https://groups.google.com/forum/#!topic/ansible-project/ftlmfIC1DHk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;つまり、ansibleがなぜか現在動いているバージョンのライブラリを参照出来ないっぽいのでこれまたなぜか&lt;/p&gt;

&lt;p&gt;　　hostsにどこのpythonを使っているのか書いてあげる必要があったということ。なぜansible.cfgではないのか&lt;/p&gt;

&lt;p&gt;・契約アカウント？で試してたらCredentialエラーが出てて、試しにIAMアカウント作成してそのIAMアカウントを&lt;/p&gt;

&lt;p&gt;　使ったら成功した。なんで？&lt;/p&gt;

&lt;p&gt;・ApacheのVHOSTのRootディレクトリが700だったので403エラーで表示されなかった。755に変更して解決。&lt;/p&gt;

&lt;p&gt;・VirtualHostの設定を行う場合、どこかに「NameVirtualHost」の記述が必要。&lt;/p&gt;

&lt;p&gt;　というより、NameVirtualHostの記述内容とその後のVirtualHostディレクティブの内容に整合性がないといけない。&lt;/p&gt;

&lt;p&gt;　なので「NameVirtuakHost *:80」の記述があれば、その後&lt;virtualhost *:80&gt;VirtualHostディレクティブが&lt;/p&gt;

&lt;p&gt;　ないといけない。&lt;/p&gt;

&lt;p&gt;もしも&lt;/virtualhost&gt;&lt;virtualhost {{hostname}}:80&gt;みたいな記述をしていた場合、NameVirtualHost {{hostname}}:80の宣言もないといけない。&lt;/p&gt;

&lt;p&gt;整合性が撮れてないと、宣言が足りないとかそんなVirtualHostディレクティブはないとか警告が出る。&lt;/p&gt;

&lt;p&gt;・Ubuntuに入ってるApache2のVirtualHostの有効化無効化&lt;/p&gt;

&lt;p&gt;　sites-availableディレクトリにVirtualHost設定書く&lt;/p&gt;

&lt;p&gt;　a2ensite {{vhost_filename}} で有効化、a2dissite {{vhost_filename}} で無効化&lt;/p&gt;

&lt;p&gt;・Hostの指定が足りない！？&lt;/p&gt;

&lt;p&gt;Could not reliably determine the server&amp;#8217;s fully qualified domain name, using for ServerName&lt;/p&gt;

&lt;p&gt;こんなエラーが出る。hostsファイルに127.0.1.1 にhogehoge.localを追記してあげたら直った&lt;/p&gt;

&lt;p&gt;　つまり、hostsファイルにhostnameが127.0.1.1で定義されている場合、Apacheが名前解決のエラー出すので、&lt;/p&gt;

&lt;p&gt;　そこに{{hostname}}.localを追記する処理追加&lt;/p&gt;

&lt;p&gt;・Ansible用MySQLの設定追加&lt;/p&gt;

&lt;p&gt;Ansibleでmysql_userモジュールを使ってユーザーを追加する際に、MySQLが外部サーバーの場合は(Webサーバーから接続用ユーザーの作成の場合は)&lt;/p&gt;

&lt;p&gt;host=%,host=localhostの記述が必要、同時に作れるのか試してない。自分は別のtaskとしてそれぞれ実行(同じユーザー名で別hostのユーザーを2回作成)&lt;/p&gt;

&lt;p&gt;リモートユーザーにあたる側(今回はWebサーバー側)にはmysql_clientのインストールが必要&lt;/p&gt;

&lt;p&gt;・netstat -ant で現在使ってるポートとか観れる&lt;/p&gt;

&lt;p&gt;　(適当な解釈、後で意味をちゃんと調べる&amp;#8230;かも)&lt;/p&gt;

&lt;p&gt;・MySQLが外部からつながらぬ&lt;/p&gt;

&lt;p&gt;webとdbをVagrantで分けて作ったら、mysqlコマンドではwebサーバーから接続できるのに、PHPからだと駄目っぽい。&lt;/p&gt;

&lt;p&gt;my.cnfの[mysqld]のところに「skip-name-resolve」を追加した。&lt;/p&gt;

&lt;p&gt;これは、名前の解決をしないという設定。Vagrantでプライベートネットワークでやっているので、IP直接指定で行っているのでこれでいいや。&lt;/p&gt;

&lt;p&gt;・ApacheのRewriteの設定漏れ&lt;/p&gt;

&lt;p&gt;UbuntuのApache2.2でRewriteをa2enmodで使えるようにしたはずなのに、動かないな〜って思ってたら、confの設定漏れてた。&lt;/p&gt;

&lt;p&gt;　AllowOverride をAllにしなかった。。。&lt;/p&gt;

&lt;p&gt;ということで？今のところ、Vagrantで作成したVMにMySQLやApacheの設定、それからWordPressの設置は出来るように&lt;/p&gt;

&lt;p&gt;なりました。&lt;/p&gt;

&lt;p&gt;それとEC2インスタンスを作成することもできた。合わせ技は&amp;#8230;別々に動かせばよくね？という事で今回のテーマはここまで。&lt;/p&gt;

&lt;p&gt;&lt;/virtualhost&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>低レベルプログラマだからJavaScriptで知らなかった事</title>
      <link>http://tech.k-zak.com/2014/08/02/spec-js</link>
      <pubDate>Sat, 02 Aug 2014 15:29:50 +0000</pubDate>
      
      <guid>http://tech.k-zak.com/2014/08/02/spec-js</guid>
      <description>&lt;p&gt;JavaScriptで知らないせいでハマったところなどなど&lt;/p&gt;

&lt;p&gt;Chromeで確認した時に動いたせいで気付かなかったんだけど、イベントトリガの関数定義で引数にeventオブジェクトを明示して渡さないとIE系では正しく動かない。これはChromeが異常なのかも。&lt;/p&gt;

&lt;p&gt;そらそうだという話なんですが、フォームの値は基本テキスト型だからJSで数字として扱って計算したい場合は数字型に変換が必要。そうしないと足し算しようとしたのに文字列連結になってしまう。&lt;/p&gt;

&lt;p&gt;JS数字計算で2進数から10進数への変換誤差がでて死ぬる。&lt;/p&gt;

&lt;p&gt;100+10.1とかやろうとすると物凄い小さい数字が誤差として丸められず残る。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>NginxでPermission denied</title>
      <link>http://tech.k-zak.com/2014/01/16/trouble-nginx</link>
      <pubDate>Thu, 16 Jan 2014 01:44:58 +0000</pubDate>
      
      <guid>http://tech.k-zak.com/2014/01/16/trouble-nginx</guid>
      <description>&lt;p&gt;開発環境&lt;/p&gt;

&lt;p&gt;OS:Ubuntu12?&lt;/p&gt;

&lt;p&gt;Webサーバー：Nginx&lt;/p&gt;

&lt;p&gt;という環境下でWindowsでホストしていたお客さんのサイトを持ってきて改修しようとしたら、&lt;/p&gt;

&lt;p&gt;jsやらcssやら画像やらが軒のみPermission denied でエラーでて表示されない。&lt;/p&gt;

&lt;p&gt;ググってみたけれども該当するものがない。&lt;/p&gt;

&lt;p&gt;※自身のテスト用のものなどはちゃんと画像等問題なく読み込める。オーナーや権限も問題ない&lt;/p&gt;

&lt;p&gt;んで、ざっとファイル見ててなんとなく気になって「Thumbs.db」を削除したら表示されるようになった。&lt;/p&gt;

&lt;p&gt;Nginxのセキュリティ機能？なのでしょうか。仕組みは調べていない。ちゃんと勉強が必要ですね。&lt;/p&gt;

&lt;p&gt;追記：どうも原因は別にあったかも。再現できない。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>FuelPHPで文字化けーアップロードファイル名とメール添付ファイル名</title>
      <link>http://tech.k-zak.com/2013/11/13/trouble-charset</link>
      <pubDate>Wed, 13 Nov 2013 15:27:30 +0000</pubDate>
      
      <guid>http://tech.k-zak.com/2013/11/13/trouble-charset</guid>
      <description>

&lt;p&gt;FuelPHPをUbuntu上で作成してWindows環境(Win2003、IIS6)に納品した結果、&lt;/p&gt;

&lt;h2 id=&#34;windowsのクライアントからファイルアップロードするとアップロードされたファイル名が文字化けしている&#34;&gt;Windowsのクライアントからファイルアップロードするとアップロードされたファイル名が文字化けしている！&lt;/h2&gt;

&lt;p&gt;(PHPの内部エンコードがUTF-8だけどWinがShift-JISだから)&lt;/p&gt;

&lt;p&gt;→アップロードは送信メールに添付したいがためにしているだけなので文字化け解消しなくても良かったのですが、後でアップロードフォルダ内の整理や確認等人力で行う場合に視認性が悪いので無理やり対応。&lt;/p&gt;

&lt;p&gt;FuelPHPのUpload::save()を行う前に&lt;/p&gt;

&lt;p&gt;ってやってアップロードファイル名をエンコードする。&lt;/p&gt;

&lt;p&gt;弊害としては本来は内部エンコードのまま処理が進むはずだったので、同名ファイルが有る場合に枝番を付加する処理なんかが正常に動作しなくなる。&lt;/p&gt;

&lt;p&gt;これでWindowsサーバーのフォルダに読める文字のファイル名でアップロードされる。&lt;/p&gt;

&lt;p&gt;最初エンコードをSJISにしてたけど、CP932にしたら、①みたいなMS拡張の機種依存文字も大丈夫になった。&lt;/p&gt;

&lt;p&gt;本当はもっとスマートな方法が欲しかったんだけど、ファイルを置くところの処理がCoreファイルで作られていて入り込む余地が無いように思えた。それとも 　　&lt;/p&gt;

&lt;pre&gt;Upload::register(&#39;after&#39;,function($file){
 　　　　文字化け状態のファイルをエンコードしなおしたファイル名でリネーム 　　
})
&lt;/pre&gt;

&lt;p&gt;とかやったら良かったのかな？&lt;/p&gt;

&lt;h2 id=&#34;文字化け状態でアップロードされたファイルをメールの添付に加えると添付ファイル名も文字化け&#34;&gt;文字化け状態でアップロードされたファイルをメールの添付に加えると添付ファイル名も文字化け！&lt;/h2&gt;

&lt;p&gt;(ま、そりゃそうですね)&lt;/p&gt;

&lt;p&gt;→上記１の結果を受けてメール送信のメソッドに引数として添付ファイル名を渡す。その処理は何も加工しない。&lt;/p&gt;

&lt;p&gt;メール送信用のメソッドの中で、引数で受け取った添付ファイル名をFuelPHPのmailに渡す処理を加工&lt;/p&gt;

&lt;p&gt;それでも、メールヘッダがISO-2022-JPなので、機種依存文字の類はメールを受信した時に「?」とかになってるけど、それはしょうがないよね。&lt;/p&gt;

&lt;h2 id=&#34;メールの件名が文字化けすることがある&#34;&gt;メールの件名が文字化けすることがある！&lt;/h2&gt;

&lt;p&gt;→犯人は半角カナ。使わないで！件名はFuelPHP側で送信時にISO-2022-JPに変換してるっぽいので、mb_convert_kana関数使って件名に含まれている半角カナを全角に変換して誤魔化す。&lt;/p&gt;

&lt;p&gt;以上、うんこメモでした。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>印刷用CSSでハマった</title>
      <link>http://tech.k-zak.com/2013/10/02/trouble-css</link>
      <pubDate>Wed, 02 Oct 2013 16:53:01 +0000</pubDate>
      
      <guid>http://tech.k-zak.com/2013/10/02/trouble-css</guid>
      <description>&lt;p&gt;この間、印刷用CSSを回収していて「そんなん知らねーよ！」ってなった事。&lt;/p&gt;

&lt;p&gt;問題のCSS: page-break-before&lt;/p&gt;

&lt;p&gt;いやコレでね強制改ページできるんで特定のdivタグのところで改ページさせようと&lt;/p&gt;

&lt;p&gt;していたんだけど、ChromeではなるのにIE(対応対象はVer 9)だと改ページしてくれない。&lt;/p&gt;

&lt;p&gt;IEでも解釈されるはずなのになんで？ってなって諦めてたんだけど、調べてたら出てきた。&lt;/p&gt;

&lt;p&gt;IEの場合はpage-break-beforeが適用される要素がページをまたぐような位置にいる場合は&lt;/p&gt;

&lt;p&gt;無視されるそうです。で、ちゃんとは調べてないのですがpage-break-beforeの場合はその&lt;/p&gt;

&lt;p&gt;要素がpage-break-afterの場合は次の要素が判定基準になるっぽぽぽぽいです。&lt;/p&gt;

&lt;p&gt;対処方法としては改ページしたい場所にからのdivを入れてその要素に対して改ページ指定の&lt;/p&gt;

&lt;p&gt;cssを適用させるって方法。Web素人には分からんよ。Web上でCSSリファレンスをさっと見ても&lt;/p&gt;

&lt;p&gt;そのことについての記述なかったし。んもう！&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>